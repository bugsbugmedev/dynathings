{"version":15,"variables":[{"key":"Application","type":"query","visible":true,"input":"fetch dt.system.events\n| filter event.kind == \"BILLING_USAGE_EVENT\"\n| filter event.type == \"Log Management & Analytics - Query\"\n| filter event.version == \"1.0\"\n| summarize distinctApps=collectDistinct(client.application_context)\n| fields values = arrayFlatten(arrayRemoveNulls(distinctApps))","multiple":true,"defaultValue":["ALL","dynatrace.automations","my.dt.lemings","my.auto.triaging.app","dynatrace.dashboards","dynatrace.notebooks","dynatrace.classic.log-events","dynatrace.classic.dashboard-log-tile","dynatrace.classic.embedded-logs","dynatrace.logs","my.onion.logs","dynatrace.kubernetes"]},{"key":"User","type":"query","visible":true,"input":"fetch dt.system.events\n| filter event.kind == \"BILLING_USAGE_EVENT\"\n| filter event.type == \"Log Management & Analytics - Query\"\n| filter event.version == \"1.0\"\n| summarize distinctUsers=collectDistinct(user.email)\n| fields values = arrayFlatten(arrayRemoveNulls(distinctUsers))\n","multiple":true,"defaultValue":["ALL","dt0s08.ace-tooling-dld-dt-api-v3@heimdall.dynatrace.com","michael.wolf@dynatrace.com","valentina.hummenberger@dynatrace.com","jonathan.brem@dynatrace.com","085fab6d-797d-40fc-adaa-ee775ec5a8ae@service.sso.dynatrace.com","dt0s08.team-idr-dt-api-v3@heimdall.dynatrace.com","hamza.yahaya@dynatrace.com","stefan.leitich@dynatrace.com","thomas.atzmueller@dynatrace.com","ben.schafer@dynatrace.com","dt0s15.team-idr-auto-triaging-dt-api@heimdall.dynatrace.com","dt0s08.apps-dev-xp-mon-prod@heimdall.dynatrace.com","igor.pernek@dynatrace.com","rebecca.burns@dynatrace.com","denis.leanos@dynatrace.com","david.haunschmied@dynatrace.com","zsombor.gegesy@dynatrace.com","paul.schumacher@dynatrace.com","ewelina.witczak@dynatrace.com","lukas.riedler@dynatrace.com","artur.chwedoruk@dynatrace.com","Markus.Riedl-Ehrenleitner@dynatrace.com","pingping.jiao@dynatrace.com","alessandro.ruzzon@dynatrace.com","michal.franczak@dynatrace.com","ernst.ambichl@dynatrace.com","bartosz.zylwis@dynatrace.com","filip.rus@dynatrace.com","Cezary.Tomaszewski@dynatrace.com","peter.zahrer@dynatrace.com","gerhard.kleemaier@dynatrace.com","pablo.diazlopez@dynatrace.com","alexandra.franz@dynatrace.com","wojciech.hnatyszyn@dynatrace.com","markus.pfleger@dynatrace.com","sascha.cervek@dynatrace.com","peter.romirer-maierhofer@dynatrace.com","pedro.machado@dynatrace.com","ilya.zhynko@dynatrace.com","manav.chugh@dynatrace.com","dt0s08.locpii-grail-client@heimdall.dynatrace.com","alexander.fisher@dynatrace.com","bernhard.fritz@dynatrace.com","marko.obradovic@dynatrace.com","mateus.saueressig@dynatrace.com","stefan.schweiger@dynatrace.com","daniela.giritzer@dynatrace.com","gabor.czibula@dynatrace.com","hans.kohlreiter@dynatrace.com","antoni.dalmases@dynatrace.com","andrew.poulter@dynatrace.com","klaus.kierer@dynatrace.com","tobias.baumgartner@dynatrace.com","peter.kastner@dynatrace.com","thomas.grassauer@dynatrace.com","christoph.neumueller@dynatrace.com","fabian.seydewitz@dynatrace.com","matthias.langer@dynatrace.com","klaus.enzenhofer@dynatrace.com","Andreas.Gruber@dynatrace.com","Bartlomiej.Zyntek@dynatrace.com","marcin.waloch@dynatrace.com","dominik.reitberger@dynatrace.com","christian.ilagan@dynatrace.com","nick.austin@dynatrace.com","daniel.schausberger@dynatrace.com","maciej.kuster@dynatrace.com","dt0s08.data-engineering-bietl@heimdall.dynatrace.com","svc_team-platform@dynatrace.com","gyorgy.kovacs@dynatrace.com","emil.chitas@dynatrace.com","shahhan.arshad@dynatrace.com","michael.schoellhammer@dynatrace.com","renee.trisberg@dynatrace.com","vlad.listopadov@dynatrace.com","stefanie.boruta@dynatrace.com","thomas.reisenbichler@dynatrace.com","Waclaw.Dziewulski@dynatrace.com","bruno.blazeka@dynatrace.com","dt0s15.team-sec-testing-access-cloud-alerts-prod@heimdall.dynatrace.com","szymon.bultrowicz@dynatrace.com","aleksei.demidov@dynatrace.com","michael.gehmayr@dynatrace.com","jakub.samczuk@dynatrace.com","philipp.brandstetter@dynatrace.com","hanno.neuer@dynatrace.com","adam.fandrejewski@dynatrace.com","davor.gornik@dynatrace.com","balint.kelen@dynatrace.com","yury.kibitz@dynatrace.com","yaryna.korduba@dynatrace.com","christian.kiesewetter@dynatrace.com","carina.bernscherer@dynatrace.com","jan.peer.stoecklmair@dynatrace.com","alisa.popova@dynatrace.com","richard.raumberger@dynatrace.com","thomas.brych@dynatrace.com","vanja.subotic@dynatrace.com","magdalena.zuschrader@dynatrace.com","martin.moser@dynatrace.com","anton.forbes@dynatrace.com","david.luftensteiner@dynatrace.com","guenther.gsenger@dynatrace.com","mario.schober@dynatrace.com","mostafa.abdelkhalek@dynatrace.com","Tobias.Aichinger@dynatrace.com","lukas.loibnegger@dynatrace.com","lukas.skofitsch@dynatrace.com","Thomas.rothschaedl@dynatrace.com","piotr.pesta@dynatrace.com","oleh.shulimov@dynatrace.com","Alois.Muehleder@dynatrace.com","dirk.wallerstorfer@dynatrace.com","aleksandar.putnik@dynatrace.com"]},{"key":"Price","type":"text","visible":true,"defaultValue":"0.002345"},{"key":"RetainPrice","type":"text","visible":true,"defaultValue":".000469"},{"key":"IngestPrice","type":"text","visible":true,"defaultValue":".134"}],"tiles":{"5":{"type":"markdown","title":"","content":"# Top 10 queries by consumption"},"7":{"type":"markdown","title":"","content":"# Bucket Ingest, Query, Retain Breakdown"},"8":{"type":"data","title":"Query by Bucket","query":"fetch dt.system.query_executions, from:$dt_timeframe_from, to:$dt_timeframe_to\n| filter status == \"SUCCEEDED\" AND scanned_bytes>0\n| fields query_string, status, timestamp, scanned_bytes, bucket = if(bucket == \"\",\"empty\",else:bucket)\n| summarize {volume = count(), sum(scanned_bytes)}, by:(bucket)\n| summarize array = collectArray(record(bucket=bucket,volume=volume)),volume=collectArray(volume)\n| fieldsAdd sum = arraySum(volume)\n| expand array\n| lookup [\n  fetch dt.system.buckets\n],\n  sourceField: array[bucket],\n  lookupField: name,\n  prefix: \"buckets.\",\n  executionOrder:leftFirst\n| filter buckets.dt.system.table==\"logs\"\n| fields `bucket` = array[bucket], `volume` = array[volume], percentage = (toDouble(array[volume]/sum) * 100)\n| sort percentage desc","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"donutChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative","hideLabels":false},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"bucket","valueAxis":"volume","categoryAxisLabel":"bucket","valueAxisLabel":"volume","tooltipVariant":"single"},"legend":{"hidden":true},"truncationMode":"middle"},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"timestamp","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"value":"volume"},"displayedFields":["bucket"],"colorMode":"color-palette","colorPalette":"blue"},"histogram":{"dataMappings":[{"valueAxis":"volume","rangeAxis":""},{"valueAxis":"percentage","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false}},"10":{"type":"markdown","title":"","content":"# Log queries not following best practices"},"12":{"type":"data","title":"Ingest by Bucket","query":"fetch dt.system.buckets, from:$dt_timeframe_from, to:$dt_timeframe_to\n| filter dt.system.table == \"logs\"\n| summarize sum(estimated_uncompressed_bytes), by: {name}, alias: size\n| sort size desc","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"pieChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"name","categoryAxisLabel":"name","valueAxis":"size","valueAxisLabel":"size","tooltipVariant":"single"},"legend":{"hidden":true},"truncationMode":"middle"},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"name","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"name\"]":352.3999938964844}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"value":"size"},"displayedFields":["name"],"colorMode":"color-palette","colorPalette":"blue"},"histogram":{"dataMappings":[{"valueAxis":"size","rangeAxis":""}]},"unitsOverrides":[{"identifier":"size","unitCategory":"data","baseUnit":"byte","displayUnit":null,"decimals":2,"suffix":"","delimiter":false,"added":1716553779865}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false}},"13":{"type":"data","title":"Log query volume","query":"fetch dt.system.events,  from:$dt_timeframe_from, to:$dt_timeframe_to\n| filter event.kind == \"BILLING_USAGE_EVENT\"\n| filter event.type == \"Log Management & Analytics - Query\"\n| filter event.version == \"1.0\"\n| makeTimeseries sum_bytes=sum(billed_bytes), time:query_start, bins:20\n| fieldsAdd query_volume = sum_bytes\n| fieldsAdd query_cost = sum_bytes[]/1024/1024/1024*toDouble($Price)\n| fieldsRemove sum_bytes","davis":{"enabled":false,"componentState":{"selectedAnalyzerName":"dt.statistics.ui.ForecastAnalyzer","inputData":{"dt.statistics.ui.ForecastAnalyzer":{"generalParameters":{"timeframe":{"startTime":"now-2h","endTime":"now"},"resolveDimensionalQueryData":true,"logVerbosity":"INFO"},"forecastHorizon":100,"forecastOffset":2,"query":"fetch dt.system.events, from:now()-7d, to:now()-15m\n| filter event.kind == \"BILLING_USAGE_EVENT\"\n| filter event.type == \"Log Management & Analytics - Query\"\n| filter event.version == \"1.0\"\n| makeTimeseries query_volume=sum(billed_bytes / 1024 / 1024 / 1024.0), interval:1h\n| fieldsAdd query_volume=arrayMovingAvg(query_volume, 5)"}}},"davisVisualization":{"isAvailable":true,"selectedOutputs":["1667436935","-1273383542"]}},"visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"hiddenLegendFields":[],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["query_volume","query_cost"],"leftAxisDimensions":[]},"categoricalBarChartSettings":{"categoryAxisLabel":"action_type","valueAxisLabel":"billed_bytes"},"colorPalette":"purple-rain","legend":{"position":"auto","hidden":false},"seriesOverrides":[{"seriesId":["query_volume"],"override":{"color":{"Default":"var(--dt-colors-charts-categorical-color-08-default, #8b6ecf)"}}}],"bandChartSettings":{"lower":"query_volume","upper":"query_cost","time":"timeframe"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"timestamp","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"value":"interval"},"displayedFields":[null],"colorMode":"color-palette","colorPalette":"blue"},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]},"unitsOverrides":[{"identifier":"query_cost","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":0,"suffix":"","delimiter":true,"added":1716549732183},{"identifier":"query_volume","unitCategory":"data","baseUnit":"byte","displayUnit":"gibibyte","decimals":1,"suffix":"","delimiter":true,"added":1717404430040}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false}},"14":{"type":"markdown","title":"","content":"# User Query Analysis"},"17":{"type":"data","title":"Query Cost","query":"fetch dt.system.events,  from:$dt_timeframe_from, to:$dt_timeframe_to\n| filter event.kind == \"BILLING_USAGE_EVENT\"\n| filter event.type == \"Log Management & Analytics - Query\"\n| filter event.version == \"1.0\"\n| summarize daily=sum(billed_bytes)/1024/1024/1024 * toDouble($Price)\n// | fieldsAdd daily_cost=(daily[]/1024/1024/1024*toDouble($Price))\n// | fieldsAdd yesterday_cost = arrayLast(daily_cost)","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{},"hiddenLegendFields":[]},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","recordField":"daily","autoscale":true,"alignment":"center","trend":{"isVisible":false,"isRelative":true},"colorThresholdTarget":"value","sparklineSettings":{"isVisible":false}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"value":"daily"},"displayedFields":[null],"colorMode":"color-palette","colorPalette":"blue"},"histogram":{"dataMappings":[{"valueAxis":"daily","rangeAxis":""}]},"unitsOverrides":[{"identifier":"daily","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":0,"suffix":"","delimiter":true,"added":1718620268306}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false}},"37":{"type":"data","title":"Query Volume","query":"fetch dt.system.events,  from:$dt_timeframe_from, to:$dt_timeframe_to\n| filter event.kind == \"BILLING_USAGE_EVENT\"\n| filter event.type == \"Log Management & Analytics - Query\"\n| filter event.version == \"1.0\"\n| makeTimeseries daily=sum(billed_bytes)\n| fieldsAdd yesterday = arrayLast(daily)","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{},"hiddenLegendFields":[],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["daily"],"leftAxisDimensions":["yesterday"]}},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","recordField":"yesterday","autoscale":true,"alignment":"center","trend":{"isVisible":false,"isRelative":true},"colorThresholdTarget":"value","sparklineSettings":{"isVisible":false}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"value":"interval"},"displayedFields":[null],"colorMode":"color-palette","colorPalette":"blue"},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""},{"valueAxis":"yesterday","rangeAxis":""}]},"unitsOverrides":[{"identifier":"yesterday","unitCategory":"data","baseUnit":"byte","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1718620268306}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false}},"40":{"type":"markdown","title":"","content":"# Log queries in Dashboards"},"48":{"type":"data","title":"","query":"fetch dt.system.events//, from:\"'+$dt_timeframe_from+'\", to:\"'+$dt_timeframe_to+'\"';\n| filter event.kind == \"BILLING_USAGE_EVENT\"\n| filter event.type == \"Log Management & Analytics - Query\"\n| filter event.version == \"1.0\"\n| filter in(\"ALL\", $User) OR in(user.email, $User)\n| filter in(\"ALL\", $Application) OR in(client.application_context, $Application)\n| fieldsAdd data = \"Logs\"\n| summarize {\n  query_start = takeFirst(query_start),\n  billed_bytes = takeFirst(billed_bytes),\n  User = takeFirst(user.email),\n  app = takeFirst(client.application_context)\n    }, by:{data, event.id}\n| fieldsAdd query_start_timestamp = timestampFromUnixMillis(query_start)\n| summarize {\n  query_volume = sum(billed_bytes),\n  query_count = count()\n    }, by:{data, User, app}\n| fieldsAdd query_cost = query_volume/1024/1024/1024*toDouble($Price)\n| fields User, App=app, `Query volume (user/app)`=query_volume, `Query cost (user/app)`=query_cost, `Query count (user/app)`=query_count\n| sort `Query volume (user/app)` desc\n| limit 50","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"table","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"User","valueAxis":"Query volume (user/app)","categoryAxisLabel":"User","valueAxisLabel":"Query volume (user/app)"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"error","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"User\"]":243.0625,"[\"App\"]":204.9375,"[\"Query volume (user/app)\"]":217.7734375,"[\"Query cost (user/app)\"]":260.6484375}},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"categorical","dataMappings":{"value":"User"},"displayedFields":["User"]},"histogram":{"dataMappings":[{"valueAxis":"Query volume (user/app)","rangeAxis":""},{"valueAxis":"Query cost (user/app)","rangeAxis":""},{"valueAxis":"Query count (user/app)","rangeAxis":""}]},"unitsOverrides":[{"identifier":"Query volume (user/app)","unitCategory":"data","baseUnit":"byte","displayUnit":"gibibyte","decimals":2,"suffix":"","delimiter":true,"added":1722501228555}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"49":{"type":"data","title":"","query":"fetch dt.system.events\n| filter event.kind == \"BILLING_USAGE_EVENT\" and billing_type == \"BILLABLE\" and event.type == \"Log Management & Analytics - Query\" and event.version == \"1.0\"\n| filter in(\"ALL\", $User) OR in(user.email, $User)\n| filter in(\"ALL\", $Application) OR in(client.application_context, $Application)\n| sort billed_bytes desc\n| limit 10\n| lookup [\n  fetch dt.system.query_executions\n],\n  sourceField: query_id,\n  lookupField: query_id,\n  prefix: \"executiondata.\",\n  executionOrder:leftFirst\n| fields\n    timestamp=toTimestamp(executiondata.timestamp),\n    query_string=executiondata.query_string,\n    query_volume=toDouble(billed_bytes),\n    query_cost = toDouble(billed_bytes)/1024/1024/1024*toDouble($Price),\n    User=user.email,\n    App=client.application_context\n| fieldsRename `Query string`=query_string, `Query volume`=query_volume, `Query cost`=query_cost\n| sort `Query volume` desc","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"table","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"Query string","valueAxis":"Query volume","categoryAxisLabel":"Query string","valueAxisLabel":"Query volume"},"fieldMapping":{"timestamp":"timestamp","leftAxisValues":["Query volume"],"leftAxisDimensions":["Query string"]},"hiddenLegendFields":[]},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"error","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"categorical","dataMappings":{"value":"timestamp"},"displayedFields":["Query string"]},"histogram":{"dataMappings":[{"valueAxis":"Query volume","rangeAxis":""},{"valueAxis":"Query cost","rangeAxis":""}]},"unitsOverrides":[{"identifier":"Query volume","unitCategory":"data","baseUnit":"byte","displayUnit":"gibibyte","decimals":1,"suffix":"","delimiter":true,"added":1722507076574},{"identifier":"Query cost","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":true,"added":1722507089121}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"50":{"type":"data","title":"","query":"fetch dt.system.query_executions\n| filter status == \"SUCCEEDED\" and startsWith(query_string, \"fetch logs\") and client.application_context==\"dynatrace.dashboards\"\n| filter in(\"ALL\", $User) OR in(user.email, $User)\n| parse client.source, \"DATA 'ui/dashboard/' STRING:dashboard.id\"\n| summarize {\n    single_query_scanned = sum(scanned_bytes),\n    dashboards = collectDistinct(dashboard.id)\n  }, by:{\n    query_id,\n    user.email,\n    query_string\n  }\n| sort single_query_scanned desc\n| limit 500 // to avoid lookup timeout, we are using only top 500 query executions\n| lookup [\n  fetch dt.system.events\n],\n  sourceField: query_id,\n  lookupField: query_id,\n  prefix: \"billing.\",\n  executionOrder:leftFirst\n\n| filter billing.billing_type == \"BILLABLE\" // keep only billed queries\n\n| summarize {\n    total_consumption = sum(billing.billed_bytes),\n    execution_count = count(),\n    users = collectDistinct(user.email),\n    dashboards = collectDistinct(dashboards)},\n  by:{query_string}\n| fields query_string, execution_count, total_consumption, total_cost=(total_consumption/1024/1024/1024*toDouble($Price)), Dashboards=arrayFlatten(dashboards), Users=users\n| fieldsRename `Query string`=query_string, `Execution count`=execution_count, `Total consumption`=total_consumption, `Total cost`=total_cost\n| sort `Total consumption` desc\n| limit 50","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"table","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"Query string","valueAxis":"Execution count","categoryAxisLabel":"Query string","valueAxisLabel":"Execution count"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"error","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"Query string\"]":826}},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"categorical","dataMappings":{"value":"Query string"},"displayedFields":["Query string"]},"histogram":{"dataMappings":[{"valueAxis":"Execution count","rangeAxis":""},{"valueAxis":"Total consumption","rangeAxis":""},{"valueAxis":"Total cost","rangeAxis":""}]},"unitsOverrides":[{"identifier":"Total consumption","unitCategory":"data","baseUnit":"byte","displayUnit":"gibibyte","decimals":1,"suffix":"","delimiter":true,"added":1722507492912},{"identifier":"Total cost","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":true,"added":1722507558256}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"51":{"type":"data","title":"","query":"fetch dt.system.events\n| filter status == \"SUCCEEDED\" and startsWith(query_string, \"fetch logs\")\n| filter in(\"ALL\", $User) OR in(user.email, $User)\n| filter in(\"ALL\", $Application) OR in(client.application_context, $Application)\n| filterOut contains(query_string, \"filter\")\n  OR contains(query_string,\"scanLimitGBytes\")\n  OR contains(query_string,\"from:\")\n  OR contains(query_string, \"samplingRatio\")\n  OR contains(query_string, \"limit\")\n| summarize {executions = count(), query_volume=sum(scanned_bytes)}, by: {query = query_string, user.email, app = client.application_context}\n| fieldsAdd query_cost = query_volume/1024/1024/1024*toDouble($Price)\n| fields  query, Executions=executions, query_volume, query_cost, User=user.email, App=app\n| fieldsRename `Query string`=query, `Query volume`=query_volume, `Query cost`=query_cost\n| sort `Query volume` desc, Executions desc, User asc\n| limit 50","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"table","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxis":"Query string","valueAxis":"Executions","categoryAxisLabel":"Query string","valueAxisLabel":"Executions"}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"error","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"categorical","dataMappings":{"value":"Query string"},"displayedFields":["Query string"]},"histogram":{"dataMappings":[{"valueAxis":"Executions","rangeAxis":""},{"valueAxis":"Query volume","rangeAxis":""},{"valueAxis":"Query cost","rangeAxis":""}]},"unitsOverrides":[{"identifier":"Query volume","unitCategory":"data","baseUnit":"byte","displayUnit":"gibibyte","decimals":1,"suffix":"","delimiter":true,"added":1722509218723},{"identifier":"Query cost","unitCategory":"unspecified","baseUnit":"none","displayUnit":null,"decimals":0,"suffix":"","delimiter":true,"added":1722509229463}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"62":{"type":"markdown","title":"","content":"### Ingest consumption"},"63":{"type":"markdown","title":"","content":"# Overall Consumption"},"65":{"type":"data","title":"Log ingest volume","query":"timeseries { logVolume = sum(dt.sfm.storage.ingest.received_bytes),  from:$dt_timeframe_from, to:$dt_timeframe_to}, \nfilter: { (dt.system.bucket == \"dt_system_metrics\") AND (data.type == \"Log\") }","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","truncationMode":"middle","categoricalBarChartSettings":{"categoryAxisLabel":"dt.security_context","valueAxisLabel":"billed_bytes","tooltipVariant":"single"},"hiddenLegendFields":[],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["logVolume"],"leftAxisDimensions":[]},"colorPalette":"purple-rain"},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"timestamp","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{},"enableThresholdInRow":false},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"blue","dataMappings":{"value":"interval"},"displayedFields":[null]},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"66":{"type":"data","title":"Retain by Bucket","query":"fetch dt.system.buckets, from:$dt_timeframe_from, to:$dt_timeframe_to\n| filter dt.system.table == \"logs\"\n| summarize estimated_uncompressed_bytes = sum(estimated_uncompressed_bytes), by:{retention_days, name} \n| fieldsRename bytes = estimated_uncompressed_bytes, retention = retention_days\n| fieldsAdd totalCost = toDouble(bytes/1024/1024/1024) * toDouble(retention) * toDouble($RetainPrice)\n| fields bucket=name, totalCost, retention\n| sort totalCost desc","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"pieChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","truncationMode":"middle","categoricalBarChartSettings":{"categoryAxis":"bucket","categoryAxisLabel":"bucket","valueAxis":"totalCost","valueAxisLabel":"totalCost","tooltipVariant":"single"},"hiddenLegendFields":[],"legend":{"hidden":true}},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"timestamp","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{"[\"totalCost\"]":155.46875,"[\"bucket\"]":207.40625},"enableThresholdInRow":false},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"blue","dataMappings":{"value":"totalCost"},"displayedFields":["bucket"]},"histogram":{"dataMappings":[{"valueAxis":"totalCost","rangeAxis":""},{"valueAxis":"retention","rangeAxis":""}]}},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"67":{"type":"data","title":"Log retainment total over time","query":"fetch dt.system.events,  from:$dt_timeframe_from, to:$dt_timeframe_to\n| filter event.kind == \"BILLING_USAGE_EVENT\"\n| filter event.type == \"Log Management & Analytics - Retain\"\n| filter event.version == \"1.0\"\n| makeTimeseries totalRetained=sum(billed_bytes), interval:10m\n//| makeTimeseries avg()\n//| fields usage.event_bucket, event.type, billed_bytes\n//| makeTimeseries monthly=sum(billed_bytes), interval:31d\n// | fieldsAdd lastmonth = arrayLast(monthly)","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"lineChart","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","truncationMode":"middle","categoricalBarChartSettings":{"categoryAxisLabel":"dt.security_context","valueAxisLabel":"billed_bytes","tooltipVariant":"single"},"hiddenLegendFields":[],"fieldMapping":{"timestamp":"timeframe","leftAxisValues":["totalRetained"],"leftAxisDimensions":[]},"colorPalette":"purple-rain"},"singleValue":{"showLabel":true,"label":"","prefixIcon":"","recordField":"timestamp","autoscale":true,"alignment":"center","colorThresholdTarget":"value"},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{},"enableThresholdInRow":false},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"blue","dataMappings":{"value":"interval"},"displayedFields":[null]},"histogram":{"dataMappings":[{"valueAxis":"interval","rangeAxis":""}]},"unitsOverrides":[{"identifier":"sum(billed_bytes)","unitCategory":"data","baseUnit":"byte","displayUnit":"terabyte","decimals":2,"suffix":"","delimiter":false,"added":1726591649603}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"70":{"type":"data","title":"Retain Cost","query":"fetch dt.system.buckets,  from:$dt_timeframe_from, to:$dt_timeframe_to\n| filter dt.system.table == \"logs\"\n| summarize estimated_uncompressed_bytes = sum(estimated_uncompressed_bytes), by:{retention_days, name} \n| fieldsRename totalRetained = estimated_uncompressed_bytes, retentionDays = retention_days\n| fieldsAdd totalCost = toDouble(totalRetained/1024/1024/1024) * toDouble(retentionDays) * toDouble($RetainPrice)\n| summarize retainmentCost=sum(totalCost)","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxisLabel":"name","valueAxisLabel":"totalRetained","tooltipVariant":"single"},"hiddenLegendFields":[],"truncationMode":"middle"},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","recordField":"retainmentCost","autoscale":true,"alignment":"center","trend":{"isVisible":true,"isRelative":true},"colorThresholdTarget":"value","sparklineSettings":{"isVisible":true}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"value":"retainmentCost"},"displayedFields":[null],"colorMode":"color-palette","colorPalette":"blue"},"histogram":{"dataMappings":[{"valueAxis":"retainmentCost","rangeAxis":""}]},"unitsOverrides":[{"identifier":"retainmentCost","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":0,"suffix":"","delimiter":true,"added":1718620268306}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false}},"71":{"type":"data","title":"Retain Volume","query":"fetch dt.system.buckets,  from:$dt_timeframe_from, to:$dt_timeframe_to\n| filter dt.system.table == \"logs\"\n| summarize estimated_uncompressed_bytes = sum(estimated_uncompressed_bytes), by:{retention_days, name} \n| fieldsRename totalRetained = estimated_uncompressed_bytes, retentionDays = retention_days\n| fieldsAdd totalCost = toDouble(totalRetained/1024/1024/1024) * toDouble(retentionDays) * toDouble($RetainPrice)\n| summarize totalRetained=sum(totalRetained)","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"categoricalBarChartSettings":{"categoryAxisLabel":"name","valueAxisLabel":"totalRetained","tooltipVariant":"single"},"hiddenLegendFields":[],"truncationMode":"middle"},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","recordField":"totalRetained","autoscale":true,"alignment":"center","trend":{"isVisible":true,"isRelative":true},"colorThresholdTarget":"value","sparklineSettings":{"isVisible":true}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{}},"honeycomb":{"shape":"hexagon","legend":"auto","dataMappings":{"value":"totalRetained"},"displayedFields":[null],"colorMode":"color-palette","colorPalette":"blue"},"histogram":{"dataMappings":[{"valueAxis":"totalRetained","rangeAxis":""}]},"unitsOverrides":[{"identifier":"totalRetained","unitCategory":"data","baseUnit":"byte","displayUnit":"terabyte","decimals":0,"suffix":"","delimiter":false,"added":1726676466232}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":100,"defaultSamplingRatio":10,"enableSampling":false}},"73":{"type":"data","title":"Ingest Volume","query":"timeseries { logVolume = sum(dt.sfm.storage.ingest.received_bytes), from:$dt_timeframe_from, to:$dt_timeframe_to}, \nfilter: { (dt.system.bucket == \"dt_system_metrics\") AND (data.type == \"Log\") }\n| fields logVolume = arraySum(logVolume)","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","truncationMode":"middle","categoricalBarChartSettings":{"categoryAxisLabel":"dt.security_context","valueAxisLabel":"billed_bytes","tooltipVariant":"single"},"hiddenLegendFields":[]},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","recordField":"logVolume","autoscale":true,"alignment":"center","colorThresholdTarget":"value","trend":{"isVisible":true}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{},"enableThresholdInRow":false},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"blue","dataMappings":{"value":"logVolume"},"displayedFields":[null]},"histogram":{"dataMappings":[{"valueAxis":"logVolume","rangeAxis":""}]},"unitsOverrides":[{"identifier":"logVolume","unitCategory":"data","baseUnit":"byte","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1726613402676}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"74":{"type":"data","title":"Ingest Cost","query":"timeseries { logVolume = sum(dt.sfm.storage.ingest.received_bytes),  from:$dt_timeframe_from, to:$dt_timeframe_to}, \nfilter: { (dt.system.bucket == \"dt_system_metrics\") AND (data.type == \"Log\") }\n| fields logVolume = toDouble(arraySum(logVolume))/1024/1024/1024*toDouble($IngestPrice)","davis":{"enabled":false,"davisVisualization":{"isAvailable":true}},"visualization":"singleValue","visualizationSettings":{"thresholds":[],"chartSettings":{"gapPolicy":"connect","circleChartSettings":{"groupingThresholdType":"relative","groupingThresholdValue":0,"valueType":"relative"},"categoryOverrides":{},"curve":"linear","pointsDisplay":"auto","truncationMode":"middle","categoricalBarChartSettings":{"categoryAxisLabel":"dt.security_context","valueAxisLabel":"billed_bytes","tooltipVariant":"single"},"hiddenLegendFields":[]},"singleValue":{"showLabel":false,"label":"","prefixIcon":"","recordField":"logVolume","autoscale":true,"alignment":"center","colorThresholdTarget":"value","trend":{"isVisible":true}},"table":{"rowDensity":"condensed","enableSparklines":false,"hiddenColumns":[],"lineWrapIds":[],"columnWidths":{},"enableThresholdInRow":false},"honeycomb":{"shape":"hexagon","legend":{"hidden":false,"position":"auto"},"colorMode":"color-palette","colorPalette":"blue","dataMappings":{"value":"logVolume"},"displayedFields":[null]},"histogram":{"dataMappings":[{"valueAxis":"logVolume","rangeAxis":""}]},"unitsOverrides":[{"identifier":"logVolume","unitCategory":"currency","baseUnit":"usd","displayUnit":null,"decimals":0,"suffix":"","delimiter":false,"added":1726613402676}]},"querySettings":{"maxResultRecords":1000,"defaultScanLimitGbytes":500,"maxResultMegaBytes":1,"defaultSamplingRatio":10,"enableSampling":false}},"75":{"type":"markdown","title":"","content":"### Query consumption"},"76":{"type":"markdown","title":"","content":"### Retain consumption"}},"layouts":{"5":{"x":0,"y":24,"w":24,"h":1},"7":{"x":0,"y":10,"w":24,"h":1},"8":{"x":8,"y":11,"w":8,"h":7},"10":{"x":0,"y":37,"w":24,"h":1},"12":{"x":0,"y":11,"w":8,"h":7},"13":{"x":8,"y":5,"w":8,"h":5},"14":{"x":0,"y":18,"w":18,"h":1},"17":{"x":16,"y":1,"w":4,"h":3},"37":{"x":4,"y":1,"w":4,"h":3},"40":{"x":0,"y":30,"w":24,"h":1},"48":{"x":0,"y":19,"w":24,"h":5},"49":{"x":0,"y":25,"w":24,"h":5},"50":{"x":0,"y":31,"w":24,"h":6},"51":{"x":0,"y":38,"w":24,"h":2},"62":{"x":0,"y":4,"w":8,"h":1},"63":{"x":0,"y":0,"w":24,"h":1},"65":{"x":0,"y":5,"w":8,"h":5},"66":{"x":16,"y":11,"w":8,"h":7},"67":{"x":16,"y":5,"w":8,"h":5},"70":{"x":20,"y":1,"w":4,"h":3},"71":{"x":8,"y":1,"w":4,"h":3},"73":{"x":0,"y":1,"w":4,"h":3},"74":{"x":12,"y":1,"w":4,"h":3},"75":{"x":8,"y":4,"w":8,"h":1},"76":{"x":16,"y":4,"w":8,"h":1}},"importedWithCode":false}